> [!NOTE] Búsqueda de Información
> Primera etapa de un Pentest.
> El objetivo es recopilar la mayor cantidad de información posible sobre el objetivo, lo que permitirá identificar vectores de ataque, debilidades y estrategias para comprometer el sistema.
> HERRAMIENTAS (extensiones) : BuiltWith , Wappalyze

> [!NOTE] Pasivo - Activo
> Se recomienda comenzar con *recolección pasiva* para identificar objetivos y posibles vectores de ataque sin levantar sospechas, y luego usar *recolección activa* para obtener datos técnicos más precisos y descubrir vulnerabilidades explotables.
##### **Passive Information Gathering**
- Evitar generar alertas o dejar rastros que puedan revelar la actividad del pentester.
	[+] Técnicas de recopilación de información (Footprinting).
		1. **Google Dorking**
		2. **Shodan y Censys**
		3. **Metadatos**
		4. **Wayback (Versiones antiguas de un site web)** `waybackmachine.com`
		5. **Brechas de seguridad**
- *Ventajas:* No genera tráfico sospechoso, bajo riesgo de detección, puede revelar datos críticos sin realizar escaneos.
- *Desventajas:* Información limitada, no se pueden verificar configuraciones o vulnerabilidades directamente.

##### **Active Information Gathering**
- Interactúa directamente con los sistemas del objetivo para obtener información más detallada. Esto suele generar tráfico en los *logs* y aumenta el riesgo de *detección*.
	[+] Técnicas de recopilación de información:
	1. **Escaneo de puertos y servicios**
	2. **Fingerprinting de tecnologías (Wappalyzer, WhatWeb):** Identificación de CMS, frameworks y tecnologías utilizadas en la web objetivo.
	3. **Enumeración SMB y NetBIOS (Windows):** Extracción de información de usuarios y recursos compartidos en entornos Windows.
	4. **Consulta de DNS y subdominios:** Identificar subdominios y registros DNS para expandir la superficie de ataque.
	5. **Enumeración de directorios**
- *Ventajas:* Proporciona información más detallada y actualizada, permite identificar vulnerabilidades directamente, facilita la planificación de la explotación
- *Desventajas:* Activar alertas en los sistemas de detección de intrusos (IDS/IPS), mayor riesgo de ser bloqueado o detectado, puede violar términos legales si no se realiza con autorización.

### Herramientas Reconocimiento Pasivo

1. **Revisar estado de una IP/Dominio**
	- `host example.com`
	- `dig example.com`
	- `ping -c 3 example.com`

2. **Google Dorking**
- ###### Buscar un sitio web 
	- `site:example.com`
- ###### Buscar un sitio web y una palabra clave dentro de una url 
	- `site:example.com inurl:admin` // Directorios también
- ###### Buscar subdominios de un sitio web 
	- `site:*.example.com`
- ###### Buscar un sitio web y el titulo de un sitio tenga una palabra especifica
	- `site:example.com intitle:admin` 
- ###### Buscar correos electrónicos a través de un tipo de archivo, xml, pdf, etc
	- `filetype:pdf "@gmail.com"`

3. **Información de servicios y puertos abiertos, infraestructura, dispositivos expuestos y certificados y dominios asociados.**
- [Censys](https://search.censys.io/)
- [Shodan](https://www.shodan.io/)

4. **Metadatos** (VPN de por medio)
- Si el documento se presenta como reciente pero fue creado/modificado hace muchos años, podría indicar *falsificación de fechas*. (Una auditoria forense permite ver si fue alterado).
- Descargar un archivo ya sea xls, pdf, etc...
```shell
cd Downloads
/Downloads$~ exiftool archivo.pdf
---
```

5. **Brechas de seguridad**
- Si se encontraron emails con *Google Dorks*, se podrían revisar si contienen su contraseña de manera pública.
- Al encontrar correos electrónicos expuestos se puede buscar si se encuentra expuestos en brechas de seguridad.
	- [-- have i been pwned?](https://haveibeenpwned.com/)

5. **Enumeración de Emails con theHavester**
- git clone https://github.com/laramies/theHarvester.git
- cd theHarvester
- If developing do:
        $ ~ > python3 -m pip install -r requirements/dev.txt
    Else:
        $ ~ > python3 -m pip install -r requirements/base.txt

    $ ~ > python3 theHarvester.py -h  
- he



### Herramientas Reconocimiento Activo
1. **Consultas DNS**
	- `dig MX example.com`
	- `dig NS example.com`
	- `whois example.com` // Devuelve más información detallada
2. **Escaneo de puertos y servicios**
	- Identificar puertos y servicios en ejecución.
	- `nmap -p- --open --min-rate 1000 example.com`
	- [Nmapper](https://www.nmmapper.com/)
3. **Fingerprinting de tecnologías**
	- Wappalyzer (firefox extensión)
	- `whatweb example.com`
4. **Enumeración de subdominios**
	- `amass enum -d example.com`
	- `sublist3r -d example.com`
	- `python3 knock.py -d example.com --recon`  - `knockpy`
	- `python3 spyhunt.py -s example.com --save subdomains`
5. **Vida de un subdominio**
	- `python3 spyhunt.py --probe subdomains --save goodsubdomains`
	- `httpx subdomains`
	- `httprobe`
6. **Enumeración de directorios**
	- `nmap --script http-enum -T4 example.com`
	- `dirseach -u http://example.com`
	- `feroxbuter -u http://example.com -w ~/Downloads/#/list.txt -C 404,403,429,400,401,405`
	- `gobuster`
### Revisión de WAF (Son activos, porque apuntan directo al server)
##### **Herramientas diseñadas para detectar y analizar WAFs. Un WAF es un firewall que protege aplicaciones web filtrando y monitoreando tráfico HTTP/S, bloqueando ataques como SQLi, XSS y RCE**

- **Wafw00f**
	- Detecta si un sitio tiene un WAF y cuál está en uso
		- `wafw00f https://example.org`
		- `wafw00f -a -v https://example.org` // -a muestra todos los intentos, -v verbose
		- `wafw00f https://example.org -o resultado.txt` // exporta el resultado en un txt
- **Whatwaf**
	- No solo detecta el WAF, sino que también prueba técnicas para bypassearlo
		- `whatwaf -u https://example.com`
		- `whatwaf -u https://example.com --run-all-tests` // Prueba evasión automáticamente.
