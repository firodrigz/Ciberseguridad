import time
import pyautogui
from PIL import Image, ImageChops
import winsound

# Definir las coordenadas y dimensiones de la región de interés (excluyendo la barra de tareas)
left = 0  # Coordenada X del borde izquierdo de la región
top = 0  # Coordenada Y del borde superior de la región
width = 800  # Ancho de la región
height = 600  # Alto de la región

def capture_screen():
    screen = pyautogui.screenshot(region=(left, top, width, height))
    return screen

def compare_images(img1, img2, threshold=10):
    diff = ImageChops.difference(img1.convert('L'), img2.convert('L'))
    diff_pixels = list(diff.getdata())
    diff_count = sum(diff_pixels) // len(diff_pixels)
    if diff_count > threshold:
        print(f"Diferencia detectada. Conteo de diferencias: {diff_count}")
        return True
    return False

def detect_screen_change(interval):
    prev_img = capture_screen()
    while True:
        time.sleep(interval)
        curr_img = capture_screen()
        if compare_images(prev_img, curr_img):
            print("Se detectó un cambio en la pantalla.")
            # Reproducir sonido de notificación
            winsound.PlaySound("SystemExclamation", winsound.SND_ALIAS)
        del prev_img
        prev_img = curr_img

# Uso: detect_screen_change(intervalo_en_segundos)
detect_screen_change(10)  # Detecta cambios cada 1 segundo y muestra notificaciones